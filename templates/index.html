<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orb - AI Knowledge Agent</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>


    <!-- Title and Icon -->
    <div class="orb-header">
        <div class="orb-header-left">
            <img src="{{ url_for('static', filename='icon-dark.png') }}" alt="Orb Icon" class="orb-icon" id="orbIcon" style="width:32px;height:32px;vertical-align:middle;margin-right:8px;">
            <span class="orb-title" style="font-size:1.5em;font-weight:bold;vertical-align:middle;">Orvin Orb</span>
        </div>
        <div class="orb-header-right">
            <button class="theme-toggle-btn" onclick="toggleTheme()" title="Switch Theme">üåô</button>
        </div>
    </div>

    <!-- Main Orb -->
    <div class="orvin-orb" id="mainOrb"></div>

    <!-- Vertical Button Column -->
    <div class="vertical-buttons" id="verticalButtons">
        <div class="vertical-button" data-panel="collections"></div>
        <div class="vertical-button" data-panel="chat"></div>
        <div class="vertical-button" data-panel="settings"></div>
    </div>

    <!-- Horizontal Button Row -->
    <div class="horizontal-buttons" id="horizontalButtons">
    </div>

    <!-- Expanded Panel -->
    <div class="expanded-panel" id="expandedPanel">
        <div class="panel-header" id="panelHeader">Welcome to Orb</div>
        <div class="panel-content" id="panelContent">
            <div class="panel-text">
                Click any button to see Orb's features in action.
            </div>
        </div>
    </div>

    <!-- Smart Suggestion -->
    <div class="smart-suggestion" id="smartSuggestion">
        <div>üí° Save this insight to your Knowledge Tree?</div>
        <div class="suggestion-buttons">
            <button class="suggestion-btn" onclick="hideSuggestion()">Save</button>
            <button class="suggestion-btn" onclick="hideSuggestion()">Dismiss</button>
        </div>
    </div>

    <!-- Command Input -->
    <input type="text" class="command-input" id="commandInput" placeholder="Ask Orb anything...">

    <!-- Chat Messages Display -->
    <div class="chat-messages-display" id="chatMessagesDisplay">
        <div class="chat-messages-header">
            <h3 id="chatTitle">New Conversation</h3>
            <div class="chat-header-actions">
                <button class="save-to-collection-btn" id="saveToCollectionBtn" title="Save chat to collection" style="display: none;">üìÅ</button>
                <button class="close-chat-btn" id="closeChatBtn">√ó</button>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="input-container">
            <div class="selectors-container">
                <div class="collection-selector-container">
                    <select class="collection-selector" id="collectionSelector">
                        <option value="">No collection selected</option>
                    </select>
                    <span class="collection-status" id="collectionStatus">Select a collection to search your documents</span>
                </div>
                <div class="agent-selector-container">
                    <select class="agent-selector" id="agentSelector">
                        <option value="">Loading agents...</option>
                    </select>
                    <span class="agent-status" id="agentStatus">Choose an AI agent for processing</span>
                </div>
                <div class="llm-selector-container">
                    <select class="llm-selector" id="llmSelector">
                        <option value="">Loading LLMs...</option>
                    </select>
                    <span class="llm-status" id="llmStatus">Choose a language model</span>
                </div>
            </div>
            <div class="chat-input-container" id="chatInputContainer">
                <input type="text" class="chat-input" id="messageInput" placeholder="Ask me anything or drag an image here...">
                <button class="send-btn" id="sendBtn" title="Send message" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="fileInput" class="file-input" accept=".txt,.pdf,.docx,.doc,.md,.jpg,.jpeg,.png,.bmp,.tiff,.gif,.mp4,.avi,.mov,.mkv,.wmv,.flv,.csv,.xlsx,.xls,.db,.sqlite" multiple>
    
    <!-- Directory import modal -->
    <div class="modal" id="directoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Directory</h3>
                <span class="close-btn" onclick="closeDirectoryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="directoryPath">Directory Path:</label>
                    <input type="text" id="directoryPath" placeholder="/path/to/your/directory" class="form-input">
                    <div class="form-help">Enter the full path to the directory you want to import</div>
                </div>
                
                <div class="supported-formats">
                    <h4>Supported File Types:</h4>
                    <div class="format-categories">
                        <div class="format-category">
                            <strong>Text:</strong> .txt, .md, .pdf, .doc, .docx
                        </div>
                        <div class="format-category">
                            <strong>Images:</strong> .jpg, .jpeg, .png, .bmp, .tiff, .gif
                        </div>
                        <div class="format-category">
                            <strong>Videos:</strong> .mp4, .avi, .mov, .mkv, .wmv, .flv
                        </div>
                        <div class="format-category">
                            <strong>Data:</strong> .csv, .xlsx, .xls, .db, .sqlite
                        </div>
                    </div>
                </div>
                
                <div class="processing-info">
                    <h4>What happens during import:</h4>
                    <ul>
                        <li>Text files are chunked and summarized</li>
                        <li>Images are analyzed with AI vision models</li>
                        <li>Videos have keyframes extracted and analyzed</li>
                        <li>All content is categorized and made searchable</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDirectoryModal()">Cancel</button>
                <button class="btn btn-primary" onclick="startDirectoryImport()">Start Import</button>
            </div>
        </div>
    </div>
    
    <!-- Import progress modal -->
    <div class="modal" id="importProgressModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Importing Directory...</h3>
            </div>
            <div class="modal-body">
                <div class="progress-info">
                    <div class="progress-status" id="importStatus">Processing files...</div>
                    <div class="progress-details" id="importDetails"></div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Save to Collection Modal -->
    <div class="modal" id="saveToCollectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Save Chat to Collection</h3>
                <span class="close-btn" onclick="closeSaveToCollectionModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Choose an option:</label>
                    <div class="save-option-buttons">
                        <button type="button" class="btn btn-secondary" onclick="selectExistingCollection()" id="existingCollectionBtn">
                            üìÇ Add to Existing Collection
                        </button>
                        <button type="button" class="btn btn-primary" onclick="selectNewCollection()" id="newCollectionBtn">
                            ‚ûï Create New Collection
                        </button>
                    </div>
                </div>
                
                <div class="existing-collection-section" id="existingCollectionSection" style="display:none;">
                    <div class="form-group">
                        <label for="existingCollectionSelect" class="form-label">Select Collection:</label>
                        <select class="form-input" id="existingCollectionSelect">
                            <option value="">Choose a collection...</option>
                        </select>
                    </div>
                </div>
                
                <div class="new-collection-section" id="newCollectionSection" style="display:none;">
                    <div class="form-group">
                        <label for="newCollectionNameInput" class="form-label">Collection Name:</label>
                        <input type="text" class="form-input" id="newCollectionNameInput" placeholder="Enter collection name...">
                    </div>
                </div>
                
                <div class="save-info">
                    <p><strong>What will be saved:</strong></p>
                    <ul>
                        <li>Complete conversation history with all messages</li>
                        <li>Timestamps and verification status</li>
                        <li>Agent and collection context used</li>
                        <li>Searchable content for future reference</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSaveToCollectionModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveChatToCollection()" id="saveConfirmBtn" disabled>Save Chat</button>
            </div>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>